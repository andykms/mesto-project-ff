(()=>{"use strict";var e=".popup__button",t="card__like-button_is-active",n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",patternErrorMessage:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},o="Сохранение...",r="Сохранить",c={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"36d03c96-8ae6-42bf-a42e-0f64d965ef64","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject(e.status)}function i(e,t){!function(e){e.classList.add("popup_is-opened")}(t),function(e){document.addEventListener("keyup",u),e.addEventListener("click",s)}(t)}function u(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function s(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&l(document.querySelector(".popup_is-opened"))}function l(e){!function(e){e.classList.remove("popup_is-opened")}(e),function(e){document.removeEventListener("keyup",u),e.removeEventListener("click",s)}(e)}function d(e,t,n,o,r,c,a,i,u,s,l){var d=e.querySelector(".places__item").cloneNode(!0);d.id=s;var p=d.querySelector(".card__image");p.src=n,p.alt=t,p.addEventListener("click",c),d.querySelector(".card__title").textContent=t;var f=d.querySelector(".card__delete-button");a?f.addEventListener("click",(function(e){return l(e,o,s)})):f.remove();var m=d.querySelector(".card__like-count");m.textContent=i;var v=d.querySelector(".card__like-button");return u&&v.classList.add("card__like-button_is-active"),v.addEventListener("click",(function(e){return r(e,s,m)})),d}function p(e,n,o){var r=e.target;r.classList.contains(t)?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(n).then((function(e){r.classList.remove(t),o.textContent=e.likes.length})).catch((function(e){console.log("".concat(messages.errorDeleteLike," ").concat(e))})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(n).then((function(e){r.classList.add(t),o.textContent=e.likes.length})).catch((function(e){console.log("".concat(messages.errorPutLike," ").concat(e))}))}function f(e){e.preventDefault();var t,n=e.currentTarget,o=n.id,r=document.getElementById("".concat(o));(t=o,fetch("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers}).then(a)).then((function(){r.remove()})).catch((function(e){console.log("".concat(messages.errorDeleteCard," ").concat(e))})).finally((function(){l(n),n.removeEventListener("submit",f)}))}function m(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function v(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.textContent=n}function _(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.textContent=""}function h(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.classList.contains(t.inputErrorClass)&&_(e,n,t.inputErrorClass)})),m(n,o,t.inactiveButtonClass)}function y(e){e.textContent===r?e.textContent=o:e.textContent=r}function S(e){e.classList.add("popup_is-animated")}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?v(e,t,n.patternErrorMessage,n.inputErrorClass):t.validity.valid?_(e,t,n.inputErrorClass):v(e,t,t.validationMessage,n.inputErrorClass)}(e,r,t),m(n,o,t.inactiveButtonClass)}))}))}(t,e)}))}(n);var E=document.querySelector(".content"),g=(document.querySelector(".page__content"),E.querySelector(".places__list")),b=document.querySelector("#card-template").content,q=document.querySelector(".popup_type_edit");S(q);var L=document.querySelector(".popup_type_new-card");S(L);var k=document.querySelector(".popup_type_image"),C=k.querySelector(".popup__caption"),x=document.querySelector(".popup_type_edit-avatar");S(x);var U=document.querySelector(".popup_type_delete-confirm");S(U);var A=k.querySelector(".popup__image");S(k);var B=E.querySelector(".profile__edit-button"),D=E.querySelector(".profile__add-button"),T=E.querySelector(".profile__title"),P=E.querySelector(".profile__description"),w=E.querySelector(".profile__image");function M(e){T.textContent=e.name,P.textContent=e.about,w.style.backgroundImage="url(".concat(e.avatar,")")}B.addEventListener("click",(function(e){N.reset(),O.value=T.textContent,j.value=P.textContent,h(N,n),i(0,q)})),D.addEventListener("click",(function(e){i(0,L)})),w.addEventListener("click",(function(e){i(0,x)})),Promise.all([fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a)]).then((function(e){var t,n;M(e[0]),t=e[1],n=e[0]._id,t.forEach((function(e){var t;V(d(b,e.name,e.link,f,p,R,n===e.owner._id,e.likes.length,(t=n,e.likes.some((function(e){return e._id===t}))),e._id,W))}))})).catch((function(e){console.log("".concat("К сожалению, не смогли получить профиль: ошибка"," ").concat(e))}));var N=document.forms.edit_profile,O=N.elements.name,j=N.elements.description,J=N.querySelector(e),H=document.forms.new_place,I=H.elements.place_name,z=H.elements.link,F=H.querySelector(e),G=document.forms.new_avatar,K=G.elements.link,Q=G.querySelector(e);function R(e){A.src=e.target.src,A.alt=e.target.alt,C.textContent=e.target.alt,i(0,k)}function V(e,t){0===t?g.prepend(e):g.append(e)}function W(e,t,n){U.id=n,i(0,U),U.addEventListener("submit",t)}N.addEventListener("submit",(function(e){e.preventDefault();var t=O.value,n=j.value;J.textContent=o,function(e,t){(function(e,t){return fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(a)})(e,t).then((function(e){M(e),l(q)})).catch((function(e){console.log("".concat("К сожалению, не смогли обновить данные профиля: ошибка"," ").concat(e))})).finally((function(){y(J)}))}(t,n)})),H.addEventListener("submit",(function(e){e.preventDefault();var t=I.value,r=z.value;F.textContent=o,function(e,t){var o,r;(o=e,r=t,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:o,link:r})}).then(a)).then((function(e){V(d(b,e.name,e.link,f,p,R,!0,e.likes.length,!1,e._id,W),0),H.reset(),h(H,n),l(L)})).catch((function(e){console.log("".concat("К сожалению, не смогли опубликовать новое место: ошибка"," ").concat(e))})).finally((function(){y(F)}))}(t,r)})),G.addEventListener("submit",(function(e){var t;e.preventDefault(),y(Q),(t=K.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){M(e),G.reset(),h(G,n),l(x)})).catch((function(e){console.log("".concat("К сожалению, не смогли обновить аватар: ошибка"," ").concat(e))})).finally((function(){y(Q)}))}))})();