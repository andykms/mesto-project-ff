(()=>{"use strict";function e(e,t,n,o,r,c,a,i,u,s){var l=e.querySelector(".places__item").cloneNode(!0),d=l.querySelector(".card__image");d.src=n,d.alt=t,d.addEventListener("click",c),l.querySelector(".card__title").textContent=t;var p=l.querySelector(".card__delete-button");a?p.addEventListener("click",(function(e){return o(e,s)})):p.remove();var f=l.querySelector(".card__like-count");f.textContent=i;var m=l.querySelector(".card__like-button");return u&&m.classList.add("card__like-button_is-active"),m.addEventListener("click",(function(e){return r(e,s,f)})),l}function t(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function n(e){!function(e){e.classList.remove("popup_is-opened")}(e),document.removeEventListener("keyup",t)}function o(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}function r(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),r.textContent=n}function c(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.textContent=""}function a(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.classList.contains(t.inputErrorClass)&&c(e,n,t.inputErrorClass)})),o(n,r,t.inactiveButtonClass)}var i={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"36d03c96-8ae6-42bf-a42e-0f64d965ef64","Content-Type":"application/json"}};function u(e){return e.ok?e.json():Promise.reject(e.status)}var s=".popup__button",l=".popup_type_delete-confirm",d="card__like-button_is-active",p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",patternErrorMessage:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},f="Сохранение...",m="Сохранить";!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o(n,a,t.inactiveButtonClass),n.forEach((function(i){i.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?r(e,t,n.patternErrorMessage,n.inputErrorClass):t.validity.valid?c(e,t,n.inputErrorClass):r(e,t,t.validationMessage,n.inputErrorClass)}(e,i,t),o(n,a,t.inactiveButtonClass)}))}))}(t,e)}))}(p);var _=document.querySelector(".content"),v=document.querySelector(".page__content"),h=_.querySelector(".places__list"),y=document.querySelector("#card-template").content,S=document.querySelector(".popup_type_edit");G(S);var q=document.querySelector(".popup_type_new-card");G(q);var b=document.querySelector(".popup_type_image"),E=b.querySelector(".popup__caption"),g=document.querySelector(".popup_type_edit-avatar"),C=document.querySelector("#card_popup-delete").content,L=b.querySelector(".popup__image");G(b);var k=_.querySelector(".profile__edit-button"),x=_.querySelector(".profile__add-button"),U=_.querySelector(".profile__title"),A=_.querySelector(".profile__description"),B=_.querySelector(".profile__image");function T(e){U.textContent=e.name,A.textContent=e.about,B.style.backgroundImage="url(".concat(e.avatar,")")}k.addEventListener("click",(function(e){D.reset(),P.value=U.textContent,w.value=A.textContent,a(D,p),K(0,S)})),x.addEventListener("click",(function(e){K(0,q)})),B.addEventListener("click",(function(e){K(0,g)})),Promise.all([fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(u),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(u)]).then((function(t){var n,o;T(t[0]),n=t[1],o=t[0]._id,n.forEach((function(t){var n;R(e(y,t.name,t.link,V,W,Q,o===t.owner._id,t.likes.length,(n=o,t.likes.some((function(e){return e._id===n}))),t._id))}))})).catch((function(e){console.log("".concat("К сожалению, не смогли получить профиль: ошибка"," ").concat(e))}));var D=document.forms.edit_profile,P=D.elements.name,w=D.elements.description,N=D.querySelector(s),M=document.forms.new_place,O=M.elements.place_name,j=M.elements.link,J=M.querySelector(s),H=document.forms.new_avatar,z=H.elements.link,I=H.querySelector(s);function F(e){e.textContent===m?e.textContent=f:e.textContent=m}function G(e){e.classList.add("popup_is-animated")}function K(e,o){!function(e){e.classList.add("popup_is-opened")}(o),function(e){document.addEventListener("keyup",t),e.addEventListener("click",(function(t){return function(e,t){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&n(t)}(t,e)}))}(o)}function Q(e){L.src=e.target.src,L.alt=e.target.alt,E.textContent=e.target.alt,K(0,b)}function R(e,t){0===t?h.prepend(e):h.append(e)}function V(e,t){var o=e.target.closest("li"),r=C.querySelector(l).cloneNode(!0);v.querySelector(l)&&v.querySelector(l).remove(),v.append(r),K(0,r),document.forms.delete_confirm.addEventListener("submit",(function(e){var c;e.preventDefault(),(c=t,fetch("".concat(i.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:i.headers}).then(u)).then((function(){o.remove()})).catch((function(e){console.log("".concat("К сожалению, не смогли удалить публикацию: ошибка"," ").concat(e))})).finally((function(){n(r),r.remove()}))}))}function W(e,t,n){var o=e.target;o.classList.contains(d)?function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(u)}(t).then((function(e){o.classList.remove(d),n.textContent=e.likes.length})).catch((function(e){console.log("".concat("К сожалению, произошла ошибка при снятии лайка: ошибка"," ").concat(e))})):function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(u)}(t).then((function(e){o.classList.add(d),n.textContent=e.likes.length})).catch((function(e){console.log("".concat("К сожалению, произошла ошибка при поставлении лайка: ошибка"," ").concat(e))}))}D.addEventListener("submit",(function(e){e.preventDefault();var t=P.value,o=w.value;N.textContent=f,function(e,t){(function(e,t){return fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(u)})(e,t).then((function(e){T(e)})).catch((function(e){console.log("".concat("К сожалению, не смогли обновить данные профиля: ошибка"," ").concat(e))})).finally((function(){F(N)}))}(t,o),D.reset(),n(S)})),M.addEventListener("submit",(function(t){t.preventDefault();var o=O.value,r=j.value;J.textContent=f,function(t,n){var o,r;(o=t,r=n,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:o,link:r})}).then(u)).then((function(t){R(e(y,t.name,t.link,V,W,Q,!0,t.likes.length,!1,t._id),0)})).catch((function(e){console.log("".concat("К сожалению, не смогли опубликовать новое место: ошибка"," ").concat(e))})).finally((function(){F(J)}))}(o,r),M.reset(),a(M,p),n(q)})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),F(I),(t=z.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(u)).then((function(e){T(e)})).catch((function(e){console.log("".concat("К сожалению, не смогли обновить аватар: ошибка"," ").concat(e))})).finally((function(){F(I)})),H.reset(),a(H,p),n(g)}))})();